
> coach.json@0.0.0 test
> vitest backend/tests/api.test.ts -t " ^generates a weekly meal plan$\


[1m[44m DEV [49m[22m [34mv4.0.12 [39m[90mC:/Users/rober/Documents/Coach[39m

 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T20:13:14.236Z[39m

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01

 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 150[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 50[2mms[22m[39m
     [32mâœ“[39m should handle empty week gracefully[32m 43[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 165[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 67[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 48[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m334[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[{"name":"Eggs","calories":500,"proteinGrams":30,"carbsGrams":5,"fatsGrams":40,"quantity":2,"unit":"pcs"}]},{"type":"lunch","items":[]},{"type":"dinner","items":['[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[{\\"name\\":\\"Eggs\\",\\"calories\\":500,\\"proteinGrams\\":30,\\"carbsGrams\\":5,\\"fatsGrams\\":40,\\"quantity\\":2,\\"unit\\":\\"pcs\\"}]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Balanced plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 1/7 complete (1 days generated so far)
ğŸ“… Generating day 2/7: 2025-01-02
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-02 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 2/7 complete (2 days generated so far)
ğŸ“… Generating day 3/7: 2025-01-03
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-03 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 3/7 complete (3 days generated so far)
ğŸ“… Generating day 4/7: 2025-01-04
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-04 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 4/7 complete (4 days generated so far)
ğŸ“… Generating day 5/7: 2025-01-05
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-05 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 5/7 complete (5 days generated so far)
ğŸ“… Generating day 6/7: 2025-01-06
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-06 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 6/7 complete (6 days generated so far)
ğŸ“… Generating day 7/7: 2025-01-07
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-07 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 7/7 complete (7 days generated so far)
ğŸ‰ Week generation complete! Generated 7 days

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

[90mstderr[2m | src/features/nutrition/NutritionPage.test.tsx[2m > [22m[2mNutritionPage[2m > [22m[2mrenders preference inputs
[22m[39mAn update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

...[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstderr[2m | src/features/nutrition/NutritionPage.test.tsx[2m > [22m[2mNutritionPage[2m > [22m[2mupdates preferences state when inputs change
[22m[39mAn update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [32mâœ“[39m backend/tests/programGenerator.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: increasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> Slightly above target - consider portion adjustments.
> ğŸ“ˆ Weight trending up slightly.
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 206[2mms[22m[39m
[90mstderr[2m | src/features/nutrition/NutritionPage.test.tsx[2m > [22m[2mNutritionPage[2m > [22m[2mshows generate button
[22m[39mAn update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to NutritionPage inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
 [32mâœ“[39m backend/tests/warmupService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m backend/tests/insight-rules.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/features/workout/Minimal.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m src/features/workout/WorkoutSessionView.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3062[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": 11215,\n'[39m +
    [32m'          "name": "large egg",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "piece",\n'[39m +
    [32m'          "calo'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfAkMe9Ht2UP75xouKVoHxBcqQjS2",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763928794,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 11215,\\n          \\"name\\": \\"large egg\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"piece\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 24,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": 20037,\\n          \\"name\\": \\"oatmeal, cooked\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 5062,\\n          \\"na'[39m
}
âœ… Generated meal plan for 2025-01-01 in 20947ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Day 1/7 complete (1 days generated so far)
ğŸ“… Generating day 2/7: 2025-01-02

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3092[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": 11206,\n'[39m +
    [32m'          "name": "Scrambled Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "oz",\n'[39m +
    [32m'          "ca'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfAkhNhJ7P1MMuBA3Glm2ewDkou6w",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763928815,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 11206,\\n          \\"name\\": \\"Scrambled Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"oz\\",\\n          \\"calories\\": 320,\\n          \\"proteinGrams\\": 28,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 22\\n        },\\n        {\\n          \\"foodId\\": 20037,\\n          \\"name\\": \\"Oatmeal, cooked\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 10003,\\n          \\'[39m
}
âœ… Generated meal plan for 2025-01-02 in 19338ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Day 2/7 complete (2 days generated so far)
ğŸ“… Generating day 3/7: 2025-01-03

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3011[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": 1123,\n'[39m +
    [32m'          "name": "Scrambled Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "oz",\n'[39m +
    [32m'          "cal'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfAl0JNRwvkfc0uwHAtY9mMYJ4Rc4",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763928834,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 1123,\\n          \\"name\\": \\"Scrambled Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"oz\\",\\n          \\"calories\\": 320,\\n          \\"proteinGrams\\": 28,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 22\\n        },\\n        {\\n          \\"foodId\\": 2000,\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 1003,\\n          \\"name\\": \\"'[39m
}
âœ… Generated meal plan for 2025-01-03 in 15948ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Day 3/7 complete (3 days generated so far)
ğŸ“… Generating day 4/7: 2025-01-04

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, scrambled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'greek yogurt, plain'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, scrambled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, whole'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'greek yogurt, plain, nonfat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, whole'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3088[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": 11215,\n'[39m +
    [32m'          "name": "Scrambled Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "oz",\n'[39m +
    [32m'          "ca'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfAlGZxUMmAqtOmayAks6FN7r6HAs",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763928850,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 11215,\\n          \\"name\\": \\"Scrambled Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"oz\\",\\n          \\"calories\\": 320,\\n          \\"proteinGrams\\": 28,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 24\\n        },\\n        {\\n          \\"foodId\\": 20037,\\n          \\"name\\": \\"Oatmeal, cooked\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": 5010,\\n          \\"'[39m
}
âœ… Generated meal plan for 2025-01-04 in 16458ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Day 4/7 complete (4 days generated so far)
ğŸ“… Generating day 5/7: 2025-01-05

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (tool_choice: none)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling search_generic_food: { query: [32m'large eggs, whole'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, skinless, cooked, roasted'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, rolled, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m11[39m, grams: [33m400[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m41[39m, grams: [33m150[39m },
    { foodId: [33m26[39m, grams: [33m100[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m11[39m, grams: [33m400[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m41[39m, grams: [33m150[39m },
    { foodId: [33m26[39m, grams: [33m100[39m }
  ]
}

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1376:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1473:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 76471[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 17[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 60015[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 16432[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 5[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 27 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mError[22m: Test timed out in 60000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m backend/tests/api.test.ts:[2m15:9[22m[39m
    [90m 13| [39m
    [90m 14| [39m    [34mdescribe[39m([32m'POST /api/nutrition/plan/week'[39m[33m,[39m () [33m=>[39m {
    [90m 15| [39m        [34mit[39m([32m'generates a weekly meal plan'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m        [31m^[39m
    [90m 16| [39m            [35mconst[39m payload [33m=[39m {
    [90m 17| [39m                weekStartDate[33m:[39m [32m'2025-01-01'[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/NutritionistEngine.test.ts[2m > [22mNutritionistEngine[2m > [22mshould handle Dairy Issues
[31m[1mError[22m: Calling the test function inside another test function is not allowed. Please put it inside "describe" or "suite" so it can be properly collected.[39m
[36m [2mâ¯[22m backend/tests/NutritionistEngine.test.ts:[2m71:9[22m[39m
    [90m 69| [39m        [34mexpect[39m(result[33m.[39mconfig[33m.[39mperMealConstraints[33m.[39mavoidDairy)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 70| [39m        [34mexpect[39m(result[33m.[39mnotes[33m.[39m[34msome[39m(n [33m=>[39m n[33m.[39m[34mincludes[39m([32m'dairy'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 71| [39m        it('should suggest volume eating if adherence is poor but workâ€¦
    [90m   | [39m        [31m^[39m
    [90m 72| [39m            [35mconst[39m result [33m=[39m [34mgenerateNutritionistPlan[39m({
    [90m 73| [39m                profile: { ...initialProfile, goals: { primary: 'fat_lâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/NutritionistEngine.test.ts[2m > [22mNutritionistEngine[2m > [22mshould adjust for progress (Stall in fat loss)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'completionRate')[39m
[36m [2mâ¯[22m generateNutritionistPlan backend/services/NutritionistEngine.ts:[2m108:31[22m[39m
    [90m106| [39m        // Pattern: High Adherence + Hunger (Hypothetical flag from châ€¦
    [90m107| [39m        // For now, let's infer "Hunger" if they are consistently sligâ€¦
    [90m108| [39m        if (progress.workouts.completionRate && progress.workouts.compâ€¦
    [90m   | [39m                              [31m^[39m
    [90m109| [39m            if ((progress.nutrition.avgCaloriesDelta || 0) > 100 && (pâ€¦
    [90m110| [39m                // "Good workouts, slight overage" -> Suggest volume eâ€¦
[90m [2mâ¯[22m backend/tests/NutritionistEngine.test.ts:[2m119:24[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progressSummaryService.test.ts[2m > [22mProgressSummaryService[2m > [22mvolume filtering[2m > [22mshould handle sessions with no warmup sets
[31m[1mAssertionError[22m: expected +0 to be undefined[39m

[32m- Expected:[39m 
undefined

[31m+ Received:[39m 
0

[36m [2mâ¯[22m backend/tests/progressSummaryService.test.ts:[2m81:53[22m[39m
    [90m 79| [39m            [34mexpect[39m(metrics[33m.[39msetsCompleted)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m 80| [39m            [34mexpect[39m(metrics[33m.[39msessionsCompleted)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m 81| [39m            expect(metrics.warmupCompletedSessions).toBeUndefined(); /â€¦
    [90m   | [39m                                                    [31m^[39m
    [90m 82| [39m        })[33m;[39m
    [90m 83| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWorkout Insights[2m > [22mgenerates strong positive message for high consistency
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m27:41[22m[39m
    [90m 25| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m 26| [39m
    [90m 27| [39m            expect(insights.some(i => i.includes('ğŸ’ª Great consistencyâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m 28| [39m            [34mexpect[39m(insights[33m.[39m[34msome[39m(i [33m=>[39m i[33m.[39m[34mincludes[39m([32m'85%'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 29| [39m        })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m27:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWorkout Insights[2m > [22msuggests finishing sets when completion rate is low
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m45:41[22m[39m
    [90m 43| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m 44| [39m
    [90m 45| [39m            expect(insights.some(i => i.includes('finishing more of whâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m 46| [39m        })[33m;[39m
    [90m 47| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m45:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWorkout Insights[2m > [22mnudges for more sessions when below minimum
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m61:41[22m[39m
    [90m 59| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m 60| [39m
    [90m 61| [39m            expect(insights.some(i => i.includes('at least 3 workouts'â€¦
    [90m   | [39m                                        [31m^[39m
    [90m 62| [39m        })[33m;[39m
    [90m 63| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m61:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWorkout Insights[2m > [22mencourages getting started when no workouts logged
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m77:41[22m[39m
    [90m 75| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m 76| [39m
    [90m 77| [39m            expect(insights.some(i => i.includes("let's get started"))â€¦
    [90m   | [39m                                        [31m^[39m
    [90m 78| [39m        })[33m;[39m
    [90m 79| [39m    })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m77:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mNutrition Insights[2m > [22mpraises excellent tracking
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m97:41[22m[39m
    [90m 95| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m 96| [39m
    [90m 97| [39m            expect(insights.some(i => i.includes('ğŸ“Š Excellent trackinâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m 98| [39m        })[33m;[39m
    [90m 99| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m97:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mNutrition Insights[2m > [22mgives on-target feedback when calories are perfect
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m117:41[22m[39m
    [90m115| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m116| [39m
    [90m117| [39m            [34mexpect[39m(insights[33m.[39m[34msome[39m(i [33m=>[39m i[33m.[39m[34mincludes[39m([32m'ğŸ¯'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m118| [39m        })[33m;[39m
    [90m119| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m117:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mNutrition Insights[2m > [22msuggests portion adjustments when significantly over
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m137:41[22m[39m
    [90m135| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m136| [39m
    [90m137| [39m            expect(insights.some(i => i.includes('adjusting portions')â€¦
    [90m   | [39m                                        [31m^[39m
    [90m138| [39m        })[33m;[39m
    [90m139| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m137:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mNutrition Insights[2m > [22msuggests more protein when significantly under target
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m157:41[22m[39m
    [90m155| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m156| [39m
    [90m157| [39m            expect(insights.some(i => i.includes('protein target'))).tâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m158| [39m        })[33m;[39m
    [90m159| [39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m157:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mNutrition Insights[2m > [22masks for more logging when insufficient data
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m175:41[22m[39m
    [90m173| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m174| [39m
    [90m175| [39m            expect(insights.some(i => i.includes('at least 5 days'))).â€¦
    [90m   | [39m                                        [31m^[39m
    [90m176| [39m        })[33m;[39m
    [90m177| [39m    })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m175:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWeight Insights[2m > [22mcelebrates weight loss trend
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m198:41[22m[39m
    [90m196| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m197| [39m
    [90m198| [39m            [34mexpect[39m(insights[33m.[39m[34msome[39m(i [33m=>[39m i[33m.[39m[34mincludes[39m([32m'ğŸ“‰'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m199| [39m            expect(insights.some(i => i.includes('trending down'))).toâ€¦
    [90m200| [39m        })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m198:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWeight Insights[2m > [22mnotes stable weight when change is minimal
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m220:41[22m[39m
    [90m218| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m219| [39m
    [90m220| [39m            [34mexpect[39m(insights[33m.[39m[34msome[39m(i [33m=>[39m i[33m.[39m[34mincludes[39m([32m'âš–ï¸'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m221| [39m            expect(insights.some(i => i.includes('steady'))).toBe(trueâ€¦
    [90m222| [39m        })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m220:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mWeight Insights[2m > [22masks for more data when insufficient weigh-ins
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m238:41[22m[39m
    [90m236| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m237| [39m
    [90m238| [39m            expect(insights.some(i => i.includes('more weigh-ins'))).tâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m239| [39m        })[33m;[39m
    [90m240| [39m    })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m238:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mCombination Insights[2m > [22mcelebrates crushing it when all metrics are strong
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m268:41[22m[39m
    [90m266| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m267| [39m
    [90m268| [39m            [34mexpect[39m(insights[33m.[39m[34msome[39m(i [33m=>[39m i[33m.[39m[34mincludes[39m([32m'ğŸ”¥'[39m)))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m269| [39m            expect(insights.some(i => i.includes('crushing it'))).toBeâ€¦
    [90m270| [39m        })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m268:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/27]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/services/insightEngine.test.ts[2m > [22mInsightEngine[2m > [22mCombination Insights[2m > [22mdoes not celebrate when only one metric is good
[31m[1mTypeError[22m: i.includes is not a function[39m
[36m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m290:41[22m[39m
    [90m288| [39m            [35mconst[39m insights [33m=[39m [34mgenerateInsights[39m(summary)[33m;[39m
    [90m289| [39m
    [90m290| [39m            expect(insights.some(i => i.includes('crushing it'))).toBeâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m291| [39m        })[33m;[39m
    [90m292| [39m    })[33m;[39m
[90m [2mâ¯[22m backend/services/insightEngine.test.ts:[2m290:29[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/nutrition/NutritionPage.test.tsx[2m > [22mNutritionPage[2m > [22mshows generate button
[31m[1mTestingLibraryElementError[22m[39m: Unable to find an element with the text: /Generate Week/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

Ignored nodes: comments, script, style
[36m<body>[39m
  [36m<div>[39m
    [36m<div[39m
      [33mclass[39m=[32m"min-h-screen bg-slate-950"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"max-w-md mx-auto px-3 pt-3 pb-24 flex flex-col gap-3"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"bg-slate-900 rounded-lg p-4 border border-slate-800"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between mb-3"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-100"[39m
            [36m>[39m
              [0mDaily Targets[0m
            [36m</h2>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"text-xs text-slate-400"[39m
                [33mfor[39m=[32m"planProfile"[39m
              [36m>[39m
                [0mProfile:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"px-2 py-1 text-xs bg-slate-800 border border-slate-700 text-slate-200 rounded hover:bg-slate-750 transition-colors"[39m
                [33mid[39m=[32m"planProfile"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"standard"[39m
                [36m>[39m
                  [0mStandard[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"glp1"[39m
                [36m>[39m
                  [0mGLP-1 Medication[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-3"[39m
          [36m>[39m
            [36m<label[39m
              [33mclass[39m=[32m"block text-sm font-medium text-slate-300 mb-1.5"[39m
              [33mfor[39m=[32m"dietType"[39m
            [36m>[39m
              [0mDiet Type[0m
            [36m</label>[39m
            [36m<select[39m
              [33mclass[39m=[32m"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-200 rounded-lg hover:bg-slate-750 transition-colors"[39m
              [33mid[39m=[32m"dietType"[39m
            [36m>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"none"[39m
              [36m>[39m
                [0mNo Restrictions[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"vegetarian"[39m
              [36m>[39m
                [0mVegetarian[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"vegan"[39m
              [36m>[39m
                [0mVegan[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"pescatarian"[39m
              [36m>[39m
                [0mPescatarian[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"keto"[39m
              [36m>[39m
                [0mKeto[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"paleo"[39m
              [36m>[39m
                [0mPaleo[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"low_carb"[39m
              [36m>[39m
                [0mLow Carb[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"mediterranean"[39m
              [36m>[39m
                [0mMediterranean[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"halal"[39m
              [36m>[39m
                [0mHalal[0m
              [36m</option>[39m
              [36m<option[39m
                [33mvalue[39m=[32m"kosher"[39m
              [36m>[39m
                [0mKosher[0m
              [36m</option>[39m
            [36m</select>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-3"[39m
          [36m>[39m
            [36m<label[39m
              [33mclass[39m=[32m"block text-sm font-medium text-slate-300 mb-1.5"[39m
              [33mfor[39m=[32m"avoidIngredients"[39m
            [36m>[39m
              [0mAvoid Ingredients[0m
            [36m</label>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-wrap gap-1.5 mb-2"[39m
            [36m/>[39m
            [36m<input[39m
              [33mclass[39m=[32m"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-200 rounded-lg placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"[39m
              [33mid[39m=[32m"avoidIngredients"[39m
              [33mplaceholder[39m=[32m"e.g., dairy, nuts, shellfish (press Enter)"[39m
              [33mtype[39m=[32m"text"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mt-1.5 flex flex-wrap gap-1.5"[39m
            [36m>[39m
              [36m<button[39m
                [33mclass[39m=[32m"px-2 py-0.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 rounded border border-slate-700 transition-colors"[39m
              [36m>[39m
                [0m+ [0m
                [0mdairy[0m
              [36m</button>[39m
              [36m<button[39m
                [33mclass[39m=[32m"px-2 py-0.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 rounded border border-slate-700 transition-colors"[39m
              [36m>[39m
                [0m+ [0m
                [0msoy[0m
              [36m</button>[39m
              [36m<button[39m
                [33mclass[39m=[32m"px-2 py-0.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 rounded border border-slate-700 transition-colors"[39m
              [36m>[39m
                [0m+ [0m
                [0mnuts[0m
              [36m</button>[39m
              [36m<button[39m
                [33mclass[39m=[32m"px-2 py-0.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 rounded border border-slate-700 transition-colors"[39m
              [36m>[39m
                [0m+ [0m
                [0mshellfish[0m
              [36m</button>[39m
              [36m<button[39m
                [33mclass[39m=[32m"px-2 py-0.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 rounded border border-slate-700 transition-colors"[39m
              [36m>[39m
                [0m+ [0m
                [0mgluten[0m
              [36m</button>[39m
              [36m<button[39m
         ...
[90m [2mâ¯[22m Object.getElementError node_modules/@testing-library/dom/dist/config.js:[2m37:19[22m[39m
[90m [2mâ¯[22m node_modules/@testing-library/dom/dist/query-helpers.js:[2m76:38[22m[39m
[90m [2mâ¯[22m node_modules/@testing-library/dom/dist/query-helpers.js:[2m52:17[22m[39m
[90m [2mâ¯[22m node_modules/@testing-library/dom/dist/query-helpers.js:[2m95:19[22m[39m
[36m [2mâ¯[22m src/features/nutrition/NutritionPage.test.tsx:[2m42:36[22m[39m
    [90m 40| [39m    [34mit[39m([32m'shows generate button'[39m[33m,[39m () [33m=>[39m {
    [90m 41| [39m        [34mrender[39m([33m<[39m[33mNutritionPage[39m [33mtargets[39m[33m=[39m[33m{[39mmockTargets[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m 42| [39m        [35mconst[39m generateBtn [33m=[39m screen[33m.[39m[34mgetByText[39m([36m/Generate Week/i[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 43| [39m        [34mexpect[39m(generateBtn)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 44| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/progress/ProgressDashboardPage.test.tsx[2m > [22mProgressDashboardPage[2m > [22mshows loading state initially
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2mâ¯[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m257:5[22m[39m
[36m [2mâ¯[22m src/features/progress/ProgressDashboardPage.test.tsx:[2m21:9[22m[39m
    [90m 19| [39m        vi.mocked(progressApi.fetchTrends).mockImplementation(() => neâ€¦
    [90m 20| [39m
    [90m 21| [39m        [34mrender[39m([33m<[39m[33mProgressDashboardPage[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m 22| [39m
    [90m 23| [39m        [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([36m/loading progress/i[39m))[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/progress/ProgressDashboardPage.test.tsx[2m > [22mProgressDashboardPage[2m > [22mshows empty state when no data
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2mâ¯[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m257:5[22m[39m
[36m [2mâ¯[22m src/features/progress/ProgressDashboardPage.test.tsx:[2m51:9[22m[39m
    [90m 49| [39m        })[33m;[39m
    [90m 50| [39m
    [90m 51| [39m        [34mrender[39m([33m<[39m[33mProgressDashboardPage[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m 52| [39m
    [90m 53| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/progress/ProgressDashboardPage.test.tsx[2m > [22mProgressDashboardPage[2m > [22mdisplays week summary correctly
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2mâ¯[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m257:5[22m[39m
[36m [2mâ¯[22m src/features/progress/ProgressDashboardPage.test.tsx:[2m85:9[22m[39m
    [90m 83| [39m        })[33m;[39m
    [90m 84| [39m
    [90m 85| [39m        [34mrender[39m([33m<[39m[33mProgressDashboardPage[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m 86| [39m
    [90m 87| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/progress/ProgressDashboardPage.test.tsx[2m > [22mProgressDashboardPage[2m > [22mdisplays weight trend chart with data
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2mâ¯[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m257:5[22m[39m
[36m [2mâ¯[22m src/features/progress/ProgressDashboardPage.test.tsx:[2m126:9[22m[39m
    [90m124| [39m        })[33m;[39m
    [90m125| [39m
    [90m126| [39m        [34mrender[39m([33m<[39m[33mProgressDashboardPage[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m127| [39m
    [90m128| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/27]â¯[22m[39m

[41m[1m FAIL [22m[49m src/features/progress/ProgressDashboardPage.test.tsx[2m > [22mProgressDashboardPage[2m > [22mshows error state when API fails
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2mâ¯[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m257:5[22m[39m
[36m [2mâ¯[22m src/features/progress/ProgressDashboardPage.test.tsx:[2m141:9[22m[39m
    [90m139| [39m        vi.mocked(progressApi.fetchTrends).mockRejectedValue(new Errorâ€¦
    [90m140| [39m
    [90m141| [39m        [34mrender[39m([33m<[39m[33mProgressDashboardPage[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m142| [39m
    [90m143| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/27]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (15)[39m
[2m      Tests [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m42 passed[39m[22m[90m (69)[39m
[2m   Start at [22m 15:13:13
[2m   Duration [22m 77.32s[2m (transform 782ms, setup 0ms, collect 2.94s, tests 77.33s, environment 2.17s, prepare 223ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

 [31mâ¯[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
[31m     [31mÃ—[31m generates a meal plan with correct system prompt payload[39m[32m 7[2mms[22m[39m
[31m     [31mÃ—[31m reuses locked meals during week generation[39m[32m 1[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

...[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâŒ generateWeeklyPlan error: ReferenceError: response is not defined
    at RealNutritionAiService.generateMealPlanForDay (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:654:26)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at RealNutritionAiService.generateMealPlanForWeek (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:421:19)
    at generateWeeklyPlan (C:/Users/rober/Documents/Coach/backend/routes.ts:124:18)
Error type: object
Error message: response is not defined
Error stack: ReferenceError: response is not defined
    at RealNutritionAiService.generateMealPlanForDay (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:654:26)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Database connected at: [35m2025-11-23T20:45:41.746Z[39m

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: decreasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> ğŸ¯ You're hitting your calorie goals consistently.
> ğŸ“‰ Weight trending down - keep up the great work!
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1271[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a full week simulation [33m 633[2mms[22m[39m
 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1024[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 61[2mms[22m[39m
     [33m[2mâœ“[22m[39m should handle empty week gracefully [33m 367[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1515[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 158[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a check-in [33m 571[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain, nonfat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling search_generic_food: { query: [32m'cooked oatmeal'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, instant'[39m }

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1358:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1455:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 46113[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 75[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[32m 235[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 45794[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 6[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 6 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[90m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/6]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[90m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/6]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2mâ¯[22m backend/tests/api.test.ts:[2m36:37[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/6]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/6]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionService.test.ts[2m > [22mRealNutritionAiService[2m > [22mgenerates a meal plan with correct system prompt payload
[31m[1mReferenceError[22m: response is not defined[39m
[90m [2mâ¯[22m RealNutritionAiService.generateMealPlanForDay backend/RealNutritionAiService.ts:[2m654:26[22m[39m
[90m [2mâ¯[22m backend/tests/nutritionService.test.ts:[2m76:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/6]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionService.test.ts[2m > [22mRealNutritionAiService[2m > [22mreuses locked meals during week generation
[31m[1mReferenceError[22m: response is not defined[39m
[90m [2mâ¯[22m RealNutritionAiService.generateMealPlanForDay backend/RealNutritionAiService.ts:[2m654:26[22m[39m
[90m [2mâ¯[22m RealNutritionAiService.generateMealPlanForWeek backend/RealNutritionAiService.ts:[2m397:19[22m[39m
[90m [2mâ¯[22m backend/tests/nutritionService.test.ts:[2m142:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/6]â¯[22m[39m


[2m Test Files [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m29 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 15:45:39
[2m   Duration [22m 54.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m334[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[{"name":"Eggs","calories":500,"proteinGrams":30,"carbsGrams":5,"fatsGrams":40,"quantity":2,"unit":"pcs"}]},{"type":"lunch","items":[]},{"type":"dinner","items":['[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[{\\"name\\":\\"Eggs\\",\\"calories\\":500,\\"proteinGrams\\":30,\\"carbsGrams\\":5,\\"fatsGrams\\":40,\\"quantity\\":2,\\"unit\\":\\"pcs\\"}]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Balanced plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 1/7 complete (1 days generated so far)
ğŸ“… Generating day 2/7: 2025-01-02
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-02 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 2/7 complete (2 days generated so far)
ğŸ“… Generating day 3/7: 2025-01-03
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-03 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 3/7 complete (3 days generated so far)
ğŸ“… Generating day 4/7: 2025-01-04
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-04 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 4/7 complete (4 days generated so far)
ğŸ“… Generating day 5/7: 2025-01-05
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-05 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 5/7 complete (5 days generated so far)
ğŸ“… Generating day 6/7: 2025-01-06
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-06 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 6/7 complete (6 days generated so far)
ğŸ“… Generating day 7/7: 2025-01-07
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-07 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Day 7/7 complete (7 days generated so far)
ğŸ‰ Week generation complete! Generated 7 days

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T20:46:27.882Z[39m

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (7 days)
ğŸ“… Generating day 1/7: 2025-01-01

.[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

..[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: decreasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> Slightly above target - consider portion adjustments.
> ğŸ“‰ Weight trending down - keep up the great work!
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 190[2mms[22m[39m
[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 245[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 62[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 143[2mms[22m[39m
 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 230[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 42[2mms[22m[39m
     [32mâœ“[39m should handle empty week gracefully[32m 36[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m2940[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": "1",\n'[39m +
    [32m'          "name": "Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "large",\n'[39m +
    [32m'          "calories": '[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfBGWx3sLjVcPBY51dINtBAacjU5x",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763930788,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"1\\",\\n          \\"name\\": \\"Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"large\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 24,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": \\"2\\",\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"3\\",\\n          \\"name\\": \\"Gril'[39m
}
âœ… Generated meal plan for 2025-01-01 in 19707ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Day 1/7 complete (1 days generated so far)
ğŸ“… Generating day 2/7: 2025-01-02

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3171[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": "1",\n'[39m +
    [32m'          "name": "Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "piece",\n'[39m +
    [32m'          "calories": '[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfBGphNmBVXzx0VrTLzJ04b13BnvP",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763930807,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"1\\",\\n          \\"name\\": \\"Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"piece\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 24,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": \\"2\\",\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 150,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        },\\n        {\\n          \\"foodId\\": \\"3\\",\\n          \\"name\\": \\"Banana\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"piece\\",\\n    '[39m
}
âœ… Generated meal plan for 2025-01-02 in 20615ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Day 2/7 complete (2 days generated so far)
ğŸ“… Generating day 3/7: 2025-01-03

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3247[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": "1",\n'[39m +
    [32m'          "name": "Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "large",\n'[39m +
    [32m'          "calories": '[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfBHA6AT8KlQCDKewQcWCjZhbxcU8",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763930828,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"1\\",\\n          \\"name\\": \\"Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"large\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 24,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": \\"2\\",\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 150,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        },\\n        {\\n          \\"foodId\\": \\"3\\",\\n          \\"name\\": \\"Banana\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"medium\\",\\n   '[39m
}
âœ… Generated meal plan for 2025-01-03 in 22224ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Day 3/7 complete (3 days generated so far)
ğŸ“… Generating day 4/7: 2025-01-04

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cheese, cheddar'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whole grain toast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whole grain toast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cheese, cheddar'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whole grain bread'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3053[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": "1",\n'[39m +
    [32m'          "name": "Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "large",\n'[39m +
    [32m'          "calories": '[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfBHWk0i4TwIpXwzJOxbXwgKnwHDf",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763930850,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"1\\",\\n          \\"name\\": \\"Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"large\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 28,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": \\"2\\",\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        }\\n      ]\\n    },\\n    {\\n      \\"type\\": \\"lunch\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"3\\",\\n          \\"name\\": \\"Gril'[39m
}
âœ… Generated meal plan for 2025-01-04 in 19561ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Day 4/7 complete (4 days generated so far)
ğŸ“… Generating day 5/7: 2025-01-05

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling search_generic_food: { query: [32m'grilled chicken breast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cooked oatmeal'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whey protein powder'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling search_generic_food: { query: [32m'grilled chicken breast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cooked oatmeal'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whey protein powder'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m3229[39m,
  contentPreview: [32m'{\n'[39m +
    [32m'  "meals": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "type": "breakfast",\n'[39m +
    [32m'      "items": [\n'[39m +
    [32m'        {\n'[39m +
    [32m'          "foodId": "1",\n'[39m +
    [32m'          "name": "Eggs",\n'[39m +
    [32m'          "quantity": 4,\n'[39m +
    [32m'          "unit": "large",\n'[39m +
    [32m'          "calories": '[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "id": "chatcmpl-CfBHq57STCg9MWG6dCqVXnnwgq6tb",\n'[39m +
    [32m'  "object": "chat.completion",\n'[39m +
    [32m'  "created": 1763930870,\n'[39m +
    [32m'  "model": "gpt-4o-mini-2024-07-18",\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "index": 0,\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "role": "assistant",\n'[39m +
    [32m'        "content": "{\\n  \\"meals\\": [\\n    {\\n      \\"type\\": \\"breakfast\\",\\n      \\"items\\": [\\n        {\\n          \\"foodId\\": \\"1\\",\\n          \\"name\\": \\"Eggs\\",\\n          \\"quantity\\": 4,\\n          \\"unit\\": \\"large\\",\\n          \\"calories\\": 280,\\n          \\"proteinGrams\\": 24,\\n          \\"carbsGrams\\": 2,\\n          \\"fatsGrams\\": 20\\n        },\\n        {\\n          \\"foodId\\": \\"2\\",\\n          \\"name\\": \\"Oatmeal\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"cup\\",\\n          \\"calories\\": 154,\\n          \\"proteinGrams\\": 6,\\n          \\"carbsGrams\\": 27,\\n          \\"fatsGrams\\": 3\\n        },\\n        {\\n          \\"foodId\\": \\"3\\",\\n          \\"name\\": \\"Banana\\",\\n          \\"quantity\\": 1,\\n          \\"unit\\": \\"medium\\",\\n   '[39m
}
âœ… Generated meal plan for 2025-01-05 in 24972ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Day 5/7 complete (5 days generated so far)
ğŸ“… Generating day 6/7: 2025-01-06

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling search_generic_food: { query: [32m'grilled chicken breast'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cooked oatmeal'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'whey protein powder'[39m }

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1373:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1470:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 113121[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 18[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 60005[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 53093[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 5[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mError[22m: Test timed out in 60000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m backend/tests/api.test.ts:[2m15:9[22m[39m
    [90m 13| [39m
    [90m 14| [39m    [34mdescribe[39m([32m'POST /api/nutrition/plan/week'[39m[33m,[39m () [33m=>[39m {
    [90m 15| [39m        [34mit[39m([32m'generates a weekly meal plan'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m        [31m^[39m
    [90m 16| [39m            [35mconst[39m payload [33m=[39m {
    [90m 17| [39m                weekStartDate[33m:[39m [32m'2025-01-01'[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 15:46:27
[2m   Duration [22m 115.04s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m334[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[{"name":"Eggs","calories":500,"proteinGrams":30,"carbsGrams":5,"fatsGrams":40,"quantity":2,"unit":"pcs"}]},{"type":"lunch","items":[]},{"type":"dinner","items":['[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[{\\"name\\":\\"Eggs\\",\\"calories\\":500,\\"proteinGrams\\":30,\\"carbsGrams\\":5,\\"fatsGrams\\":40,\\"quantity\\":2,\\"unit\\":\\"pcs\\"}]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Balanced plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (single LLM call for all 7 days)
ğŸ¤– Calling gpt-4o-mini for weekly meal plan (single call for all 7 days)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m221[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[]},{"type":"lunch","items":[]},{"type":"dinner","items":[]},{"type":"snack","items":[]}],"totalCalories":2000,"totalProtein":150,"totalCarbs":200,"totalFats":65,'[39m
}

 [31mâ¯[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 12[2mms[22m[39m
     [32mâœ“[39m generates a meal plan with correct system prompt payload[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m reuses locked meals during week generation[39m[32m 6[2mms[22m[39m
[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:02:53.382Z[39m

 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 541[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 67[2mms[22m[39m
     [33m[2mâœ“[22m[39m should handle empty week gracefully [33m 384[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

...[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.....[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (single LLM call for all 7 days)
ğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for weekly meal plan (single call for all 7 days)...

..[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: decreasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> Slightly above target - consider portion adjustments.
> ğŸ“‰ Weight trending down - keep up the great work!
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 818[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 526[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 228[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 86[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'quinoa, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, low fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, low fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, 1% milkfat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'low fat milk'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_branded_item: { query: [32m'cottage cheese'[39m, brand: [32m"Breakstone's"[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, 0% fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'low fat milk'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m300[39m },
    { foodId: [33m41[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m25[39m, grams: [33m300[39m },
    { foodId: [33m2[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m300[39m },
    { foodId: [33m41[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m25[39m, grams: [33m300[39m },
    { foodId: [33m2[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m300[39m },
    { foodId: [33m41[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m25[39m, grams: [33m300[39m },
    { foodId: [33m2[39m, grams: [33m200[39m }
  ]
}
   ğŸ”§ Calling search_generic_food: { query: [32m'low fat milk'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   âœ… LLM final response received

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: TypeError: Cannot read properties of undefined (reading 'length')
    at C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1511:37
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at async Promise.all (index 0)
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1507:28)
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1587:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: {
    originalError: [32m"TypeError: Cannot read properties of undefined (reading 'length')"[39m
  }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 89501[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 33[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 60003[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 29456[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 8[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 5 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mError[22m: Test timed out in 60000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m backend/tests/api.test.ts:[2m15:9[22m[39m
    [90m 13| [39m
    [90m 14| [39m    [34mdescribe[39m([32m'POST /api/nutrition/plan/week'[39m[33m,[39m () [33m=>[39m {
    [90m 15| [39m        [34mit[39m([32m'generates a weekly meal plan'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m        [31m^[39m
    [90m 16| [39m            [35mconst[39m payload [33m=[39m {
    [90m 17| [39m                weekStartDate[33m:[39m [32m'2025-01-01'[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionService.test.ts[2m > [22mRealNutritionAiService[2m > [22mreuses locked meals during week generation
[31m[1mNutritionApiError[22m: Invalid weekly meal plan format received. Expected 7 days, got 0[39m
[36m [2mâ¯[22m RealNutritionAiService.generateMealPlanForWeek backend/RealNutritionAiService.ts:[2m532:13[22m[39m
    [90m530| [39m    [90m// Validate response structure[39m
    [90m531| [39m    if (!parsed.days || !Array.isArray(parsed.days) || parsed.days.lenâ€¦
    [90m532| [39m      [35mthrow[39m [35mnew[39m [33mNutritionApiError[39m(
    [90m   | [39m            [31m^[39m
    [90m533| [39m        [32m'AI_PLAN_FAILED'[39m[33m,[39m
    [90m534| [39m        `Invalid weekly meal plan format received. Expected 7 days, goâ€¦
[90m [2mâ¯[22m backend/tests/nutritionService.test.ts:[2m142:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯[22m[39m


[2m Test Files [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m28 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:02:51
[2m   Duration [22m 96.19s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ” Final OpenAI response: {
  finishReason: [32m'stop'[39m,
  hasContent: [33mtrue[39m,
  contentLength: [33m334[39m,
  contentPreview: [32m'{"meals":[{"type":"breakfast","items":[{"name":"Eggs","calories":500,"proteinGrams":30,"carbsGrams":5,"fatsGrams":40,"quantity":2,"unit":"pcs"}]},{"type":"lunch","items":[]},{"type":"dinner","items":['[39m,
  fullResponse: [32m'{\n'[39m +
    [32m'  "choices": [\n'[39m +
    [32m'    {\n'[39m +
    [32m'      "finish_reason": "stop",\n'[39m +
    [32m'      "message": {\n'[39m +
    [32m'        "content": "{\\"meals\\":[{\\"type\\":\\"breakfast\\",\\"items\\":[{\\"name\\":\\"Eggs\\",\\"calories\\":500,\\"proteinGrams\\":30,\\"carbsGrams\\":5,\\"fatsGrams\\":40,\\"quantity\\":2,\\"unit\\":\\"pcs\\"}]},{\\"type\\":\\"lunch\\",\\"items\\":[]},{\\"type\\":\\"dinner\\",\\"items\\":[]},{\\"type\\":\\"snack\\",\\"items\\":[]}],\\"totalCalories\\":2000,\\"totalProtein\\":150,\\"totalCarbs\\":200,\\"totalFats\\":65,\\"explanation\\":\\"Balanced plan\\"}"\n'[39m +
    [32m'      }\n'[39m +
    [32m'    }\n'[39m +
    [32m'  ]\n'[39m +
    [32m'}'[39m
}
âœ… Generated meal plan for 2025-01-01 in 2ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (3 batches: 3+2+2 days)

 [31mâ¯[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 11[2mms[22m[39m
     [32mâœ“[39m generates a meal plan with correct system prompt payload[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m reuses locked meals during week generation[39m[32m 6[2mms[22m[39m
[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

.[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

..[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:22:59.932Z[39m

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Starting week generation for 2025-01-01 (3 batches: 3+2+2 days)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâŒ generateWeeklyPlan error: TypeError: this.generateDayBatch is not a function
    at RealNutritionAiService.generateMealPlanForWeek (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:380:31)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at generateWeeklyPlan (C:/Users/rober/Documents/Coach/backend/routes.ts:124:18)
Error type: object
Error message: this.generateDayBatch is not a function
Error stack: TypeError: this.generateDayBatch is not a function
    at RealNutritionAiService.generateMealPlanForWeek (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:380:31)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F
ğŸ¤– Using OpenAI with model: gpt-4o-mini

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: increasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> Slightly above target - consider portion adjustments.
> ğŸ“ˆ Weight trending up slightly.
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 403[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 348[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 113[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 112[2mms[22m[39m
 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 767[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 59[2mms[22m[39m
     [33m[2mâœ“[22m[39m should handle empty week gracefully [33m 571[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg large'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'spinach cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'quinoa cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'egg white'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, low fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, low fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'turkey breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'black beans, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m16[39m, grams: [33m200[39m },
    { foodId: [33m41[39m, grams: [33m100[39m },
    { foodId: [33m36[39m, grams: [33m200[39m },
    { foodId: [33m2[39m, grams: [33m150[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m16[39m, grams: [33m200[39m },
    { foodId: [33m41[39m, grams: [33m100[39m },
    { foodId: [33m36[39m, grams: [33m200[39m },
    { foodId: [33m2[39m, grams: [33m150[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m16[39m, grams: [33m200[39m },
    { foodId: [33m41[39m, grams: [33m100[39m },
    { foodId: [33m36[39m, grams: [33m200[39m },
    { foodId: [33m2[39m, grams: [33m150[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m16[39m, grams: [33m200[39m },
    { foodId: [33m41[39m, grams: [33m100[39m },
    { foodId: [33m36[39m, grams: [33m200[39m },
    { foodId: [33m2[39m, grams: [33m150[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m200[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m16[39m, grams: [33m200[39m },
    { foodId: [33m41[39m, grams: [33m100[39m },
    { foodId: [33m36[39m, grams: [33m200[39m },
    { foodId: [33m2[39m, grams: [33m150[39m }
  ]
}

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1346:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1443:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 17619[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 25[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[32m 212[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 17376[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 4[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 5 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m36:37[22m[39m
    [90m 34| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 35| [39m
    [90m 36| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 37| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'weekStartDate'[39m)[33m;[39m
    [90m 38| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata[33m.[39mdays)[33m.[39m[34mtoHaveLength[39m([34m7[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionService.test.ts[2m > [22mRealNutritionAiService[2m > [22mreuses locked meals during week generation
[31m[1mTypeError[22m: this.generateDayBatch is not a function[39m
[36m [2mâ¯[22m RealNutritionAiService.generateMealPlanForWeek backend/RealNutritionAiService.ts:[2m380:31[22m[39m
    [90m378| [39m    [90m// Batch 1: Days 0-2 (3 days)[39m
    [90m379| [39m    onProgress?.({ current: 0, total: 7, message: 'Generating days 1-3â€¦
    [90m380| [39m    [35mconst[39m batch1 [33m=[39m [35mawait[39m [35mthis[39m[33m.[39m[34mgenerateDayBatch[39m({
    [90m   | [39m                              [31m^[39m
    [90m381| [39m      startDate[33m,[39m
    [90m382| [39m      startIndex[33m:[39m [34m0[39m[33m,[39m
[90m [2mâ¯[22m backend/tests/nutritionService.test.ts:[2m142:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯[22m[39m


[2m Test Files [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m28 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:22:57
[2m   Duration [22m 23.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 5 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m [ backend/tests/nutritionist-api.test.ts ][22m
[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m [ backend/tests/progress-smoke.test.ts ][22m
[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m [ backend/tests/api.test.ts ][22m
[41m[1m FAIL [22m[49m backend/tests/simulation-real-week.test.ts[2m [ backend/tests/simulation-real-week.test.ts ][22m
[41m[1m FAIL [22m[49m backend/tests/nutritionService.test.ts[2m [ backend/tests/nutritionService.test.ts ][22m
[31m[1mError[22m: Transform failed with 1 error:
C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:684:8: ERROR: Expected ";" but found "generateMealPlanForDay"[39m
  Plugin: [35mvite:esbuild[39m
  File: [36mC:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts[39m:684:8
[33m  
  [33mExpected ";" but found "generateMealPlanForDay"[33m
  682 |  }
  683 |  
  684 |    async generateMealPlanForDay(args: {
      |          ^
  685 |    date: string;
  686 |    targets: NutritionTargets;
  [39m
[90m [2mâ¯[22m failureErrorWithLog node_modules/esbuild/lib/main.js:[2m1467:15[22m[39m
[90m [2mâ¯[22m node_modules/esbuild/lib/main.js:[2m736:50[22m[39m
[90m [2mâ¯[22m responseCallbacks.<computed> node_modules/esbuild/lib/main.js:[2m603:9[22m[39m
[90m [2mâ¯[22m handleIncomingPacket node_modules/esbuild/lib/main.js:[2m658:12[22m[39m
[90m [2mâ¯[22m Socket.readFromStdout node_modules/esbuild/lib/main.js:[2m581:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯[22m[39m


[2m Test Files [22m [1m[31m10 failed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m23 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (33)[39m
[2m   Start at [22m 16:24:05
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mâœ… Generated meal plan for 2025-01-01 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-01 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-02 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-03 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-04 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-05 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-06 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-07 in 0ms

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:25:08.004Z[39m

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

...[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1034[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 62[2mms[22m[39m
     [33m[2mâœ“[22m[39m should handle empty week gracefully [33m 758[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: increasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> ğŸ¯ You're hitting your calorie goals consistently.
> ğŸ“ˆ Weight trending up slightly.
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 703[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a full week simulation [33m 490[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1367[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[33m 339[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a check-in [33m 836[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-01 in 37613ms

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâŒ Meal plan generation failed for 2025-01-02 after 11863ms: RateLimitError: 429 Rate limit reached for gpt-4o-mini in organization org-c3K81ISEQQIEmNUz7y5sQwOW on tokens per min (TPM): Limit 200000, Used 200000, Requested 850. Please try again in 255ms. Visit https://platform.openai.com/account/rate-limits to learn more.
    at Function.generate [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/core/error.mjs:59:20[90m)[39m
    at OpenAI.makeStatusError [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/client.mjs:162:32[90m)[39m
    at OpenAI.makeRequest [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/client.mjs:330:30[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at RealNutritionAiService.generateMealPlanForDay (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:665:20)
    at RealNutritionAiService.generateMealPlanForWeek (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:416:21)
    at generateWeeklyPlan (C:/Users/rober/Documents/Coach/backend/routes.ts:124:18) {
  status: [33m429[39m,
  headers: Headers {
    date: [32m'Sun, 23 Nov 2025 21:25:57 GMT'[39m,
    [32m'content-type'[39m: [32m'application/json; charset=utf-8'[39m,
    [32m'content-length'[39m: [32m'377'[39m,
    connection: [32m'keep-alive'[39m,
    [32m'retry-after'[39m: [32m'1'[39m,
    [32m'retry-after-ms'[39m: [32m'255'[39m,
    vary: [32m'Origin'[39m,
    [32m'x-ratelimit-limit-requests'[39m: [32m'10000'[39m,
    [32m'x-ratelimit-limit-tokens'[39m: [32m'200000'[39m,
    [32m'x-ratelimit-remaining-requests'[39m: [32m'9543'[39m,
    [32m'x-ratelimit-remaining-tokens'[39m: [32m'0'[39m,
    [32m'x-ratelimit-reset-requests'[39m: [32m'1h5m43.381s'[39m,
    [32m'x-ratelimit-reset-tokens'[39m: [32m'1m4.799s'[39m,
    [32m'x-request-id'[39m: [32m'req_2322a51008d249eb930bfe10226ece9b'[39m,
    [32m'x-envoy-upstream-service-time'[39m: [32m'11'[39m,
    [32m'x-openai-proxy-wasm'[39m: [32m'v0.1'[39m,
    [32m'cf-cache-status'[39m: [32m'DYNAMIC'[39m,
    [32m'set-cookie'[39m: [32m'__cf_bm=PibX40.jA6tjUc_qc8YnJzVqR_ITyMYsS6V3eblDgxo-1763933157-1.0.1.1-MVAiN868QCBQVJ8C6tfZdtcJ9lhK_LH3G5CIQMxprHZ6feMcAxS2hpDbddIi9zJB0ZTO_siFJqjysSP7WfOFNgFS4rPN97eRLt50k.9jmR4; path=/; expires=Sun, 23-Nov-25 21:55:57 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=qXnf_DyOFu3mA35lEqr3VDB1ZSquijvFAiTzOY8DpTQ-1763933157379-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'[39m,
    [32m'strict-transport-security'[39m: [32m'max-age=31536000; includeSubDomains; preload'[39m,
    [32m'x-content-type-options'[39m: [32m'nosniff'[39m,
    server: [32m'cloudflare'[39m,
    [32m'cf-ray'[39m: [32m'9a33bdf9088828a0-IAD'[39m,
    [32m'alt-svc'[39m: [32m'h3=":443"; ma=86400'[39m
  },
  requestID: [32m'req_2322a51008d249eb930bfe10226ece9b'[39m,
  error: {
    message: [32m'Rate limit reached for gpt-4o-mini in organization org-c3K81ISEQQIEmNUz7y5sQwOW on tokens per min (TPM): Limit 200000, Used 200000, Requested 850. Please try again in 255ms. Visit https://platform.openai.com/account/rate-limits to learn more.'[39m,
    type: [32m'tokens'[39m,
    param: [1mnull[22m,
    code: [32m'rate_limit_exceeded'[39m
  },
  code: [32m'rate_limit_exceeded'[39m,
  param: [1mnull[22m,
  type: [32m'tokens'[39m
}

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâŒ generateWeeklyPlan error: NutritionApiError: An unexpected error occurred during meal planning. Please try again.
    at RealNutritionAiService.generateMealPlanForDay (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:779:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at RealNutritionAiService.generateMealPlanForWeek (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:416:21)
    at generateWeeklyPlan (C:/Users/rober/Documents/Coach/backend/routes.ts:124:18) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: [90mundefined[39m
}
Error type: object
Error message: An unexpected error occurred during meal planning. Please try again.
Error stack: NutritionApiError: An unexpected error occurred during meal planning. Please try again.
    at RealNutritionAiService.generateMealPlanForDay (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:779:13)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: RateLimitError: 429 Rate limit reached for gpt-4o-mini in organization org-c3K81ISEQQIEmNUz7y5sQwOW on tokens per min (TPM): Limit 200000, Used 200000, Requested 207. Please try again in 62ms. Visit https://platform.openai.com/account/rate-limits to learn more.
    at Function.generate [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/core/error.mjs:59:20[90m)[39m
    at OpenAI.makeStatusError [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/client.mjs:162:32[90m)[39m
    at OpenAI.makeRequest [90m(file:///C:/Users/rober/Documents/Coach/[39mnode_modules/[4mopenai[24m/client.mjs:330:30[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1289:24)
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  status: [33m429[39m,
  headers: Headers {
    date: [32m'Sun, 23 Nov 2025 21:25:57 GMT'[39m,
    [32m'content-type'[39m: [32m'application/json; charset=utf-8'[39m,
    [32m'content-length'[39m: [32m'376'[39m,
    connection: [32m'keep-alive'[39m,
    [32m'retry-after'[39m: [32m'1'[39m,
    [32m'retry-after-ms'[39m: [32m'62'[39m,
    vary: [32m'Origin'[39m,
    [32m'x-ratelimit-limit-requests'[39m: [32m'10000'[39m,
    [32m'x-ratelimit-limit-tokens'[39m: [32m'200000'[39m,
    [32m'x-ratelimit-remaining-requests'[39m: [32m'9531'[39m,
    [32m'x-ratelimit-remaining-tokens'[39m: [32m'0'[39m,
    [32m'x-ratelimit-reset-requests'[39m: [32m'1h7m25.94s'[39m,
    [32m'x-ratelimit-reset-tokens'[39m: [32m'1m4.205s'[39m,
    [32m'x-request-id'[39m: [32m'req_5790bf8c25bc41d6ac7c17f9127022fb'[39m,
    [32m'x-envoy-upstream-service-time'[39m: [32m'7'[39m,
    [32m'x-openai-proxy-wasm'[39m: [32m'v0.1'[39m,
    [32m'cf-cache-status'[39m: [32m'DYNAMIC'[39m,
    [32m'set-cookie'[39m: [32m'__cf_bm=wk9m8fETmoWmSJTzWLVsiIt8s1rAuskswaX4f3z2bwc-1763933157-1.0.1.1-qgXwbi.LDpOs9_DZqVB0Znk86rxmO2j5REcR51W66FsbfAvC6gmyhU6N.G2WFOM3l6fgV04.vm9L4OheE2dTrJpNQvXFBtEcmZatx5Qz7Hs; path=/; expires=Sun, 23-Nov-25 21:55:57 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=pDCVjysvtEerpFSTtkXBGDV93vmqKx313OBn1D.b68s-1763933157822-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'[39m,
    [32m'strict-transport-security'[39m: [32m'max-age=31536000; includeSubDomains; preload'[39m,
    [32m'x-content-type-options'[39m: [32m'nosniff'[39m,
    server: [32m'cloudflare'[39m,
    [32m'cf-ray'[39m: [32m'9a33bdfbfb6528a0-IAD'[39m,
    [32m'alt-svc'[39m: [32m'h3=":443"; ma=86400'[39m
  },
  requestID: [32m'req_5790bf8c25bc41d6ac7c17f9127022fb'[39m,
  error: {
    message: [32m'Rate limit reached for gpt-4o-mini in organization org-c3K81ISEQQIEmNUz7y5sQwOW on tokens per min (TPM): Limit 200000, Used 200000, Requested 207. Please try again in 62ms. Visit https://platform.openai.com/account/rate-limits to learn more.'[39m,
    type: [32m'tokens'[39m,
    param: [1mnull[22m,
    code: [32m'rate_limit_exceeded'[39m
  },
  code: [32m'rate_limit_exceeded'[39m,
  param: [1mnull[22m,
  type: [32m'tokens'[39m
}

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1456:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: {
    originalError: [32m'Error: 429 Rate limit reached for gpt-4o-mini in organization org-c3K81ISEQQIEmNUz7y5sQwOW on tokens per min (TPM): Limit 200000, Used 200000, Requested 207. Please try again in 62ms. Visit https://platform.openai.com/account/rate-limits to learn more.'[39m
  }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 50197[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 21[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 49735[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 435[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 4[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m36:37[22m[39m
    [90m 34| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 35| [39m
    [90m 36| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 37| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'weekStartDate'[39m)[33m;[39m
    [90m 38| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata[33m.[39mdays)[33m.[39m[34mtoHaveLength[39m([34m7[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:25:06
[2m   Duration [22m 57.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[2m4:26:27 PM[22m [33m[1m[vite][22m[39m [33m[2m(ssr)[22m[39m [33mwarning: [33mThis assignment will throw because "response" is a constant[33m
663 |          }
664 |  
665 |          response = await openai.chat.completions.create({
    |          ^
666 |            model: getModel(),
667 |            messages,
[39m
  Plugin: [35mvite:esbuild[39m
  File: [36mC:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mâœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-01 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-02 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-03 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-04 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-05 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-06 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-07 in 1ms

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

.[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

..[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:26:28.884Z[39m

 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 717[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 61[2mms[22m[39m
     [32mâœ“[39m should handle empty week gracefully[32m 223[2mms[22m[39m
[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: stable

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> Slightly above target - consider portion adjustments.
> âš–ï¸ Weight holding steady.
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 492[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a full week simulation [33m 354[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1265[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[33m 823[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 128[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-01 in 13088ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-02 in 13895ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-03 in 13861ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-04 in 14977ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'avocado'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'salmon, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'quinoa, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m41[39m, grams: [33m150[39m },
    { foodId: [33m25[39m, grams: [33m300[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m400[39m },
    { foodId: [33m41[39m, grams: [33m150[39m },
    { foodId: [33m25[39m, grams: [33m300[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'protein powder, whey'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'whey protein powder'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_branded_item: { query: [32m'whey protein'[39m, brand: [32m'Optimum Nutrition'[39m }
   ğŸ”§ Calling search_branded_item: { query: [32m'protein bar'[39m, brand: [32m'Quest'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Generated meal plan for 2025-01-05 in 16096ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   âœ… LLM final response received

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: TypeError: Cannot read properties of undefined (reading 'length')
    at C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1380:37
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at async Promise.all (index 0)
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1376:28)
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1456:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: {
    originalError: [32m"TypeError: Cannot read properties of undefined (reading 'length')"[39m
  }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 75644[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 19[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 60003[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 15615[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 6[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[90m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[90m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mError[22m: Test timed out in 60000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[90m [2mâ¯[22m backend/tests/api.test.ts:[2m15:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[90m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:26:26
[2m   Duration [22m 81.63s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mâœ… Generated meal plan for 2025-01-01 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-02 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-03 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-04 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-05 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-06 in 0ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… Generated meal plan for 2025-01-07 in 1ms

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:27:44.647Z[39m

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

.[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

..[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

...... [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 148[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 52[2mms[22m[39m
     [32mâœ“[39m should handle empty week gracefully[32m 45[2mms[22m[39m
.[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

... [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 162[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[32m 70[2mms[22m[39m
     [32mâœ“[39m should run a check-in[32m 46[2mms[22m[39m
....[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: decreasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> ğŸ¯ You're hitting your calorie goals consistently.
> ğŸ“‰ Weight trending down - keep up the great work!
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 213[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-01 in 14851ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-02 in 14599ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-03 in 15373ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-04 in 13604ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oatmeal, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'cottage cheese, low fat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'peanut butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'turkey breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain, nonfat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâœ… Generated meal plan for 2025-01-05 in 14123ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling calculate_recipe_macros: {
  ingredients: [
    { foodId: [33m15[39m, grams: [33m400[39m },
    { foodId: [33m33[39m, grams: [33m100[39m },
    { foodId: [33m2[39m, grams: [33m150[39m },
    { foodId: [33m16[39m, grams: [33m300[39m },
    { foodId: [33m20[39m, grams: [33m200[39m }
  ]
}

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1325:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1422:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 74923[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 21[2mms[22m[39m
[31m       [31mÃ—[31m generates a weekly meal plan[39m[33m 60012[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 14885[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 4[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/week[2m > [22mgenerates a weekly meal plan
[31m[1mError[22m: Test timed out in 60000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m backend/tests/api.test.ts:[2m15:9[22m[39m
    [90m 13| [39m
    [90m 14| [39m    [34mdescribe[39m([32m'POST /api/nutrition/plan/week'[39m[33m,[39m () [33m=>[39m {
    [90m 15| [39m        [34mit[39m([32m'generates a weekly meal plan'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m        [31m^[39m
    [90m 16| [39m            [35mconst[39m payload [33m=[39m {
    [90m 17| [39m                weekStartDate[33m:[39m [32m'2025-01-01'[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:27:44
[2m   Duration [22m 76.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mbackend/RealNutritionAiService.ts [22m[39m
       [2m Filename pattern: [22m[34mbackend/tests/api.test.ts, ^generates, a, weekly, meal, plan$/[39m

 [31mâ¯[39m backend/tests/progressSummaryService.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should exclude warmup sets from volume metrics[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle sessions with only warmup sets[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle sessions with no warmup sets[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle empty sessions gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should track sessions with warmups completed[32m 0[2mms[22m[39m
 [31mâ¯[39m backend/services/insightEngine.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m generates strong positive message for high consistency[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m suggests finishing sets when completion rate is low[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m nudges for more sessions when below minimum[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m encourages getting started when no workouts logged[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m praises excellent tracking[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m gives on-target feedback when calories are perfect[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests portion adjustments when significantly over[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m suggests more protein when significantly under target[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more logging when insufficient data[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates weight loss trend[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m notes stable weight when change is minimal[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m asks for more data when insufficient weigh-ins[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m celebrates crushing it when all metrics are strong[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m does not celebrate when only one metric is good[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/progress/ProgressDashboardPage.test.tsx [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m shows loading state initially[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m shows empty state when no data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m displays week summary correctly[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m displays weight trend chart with data[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m shows error state when API fails[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m backend/tests/NutritionistEngine.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 9[2mms[22m[39m
     [32mâœ“[39m should generate default plan for healthy user[32m 2[2mms[22m[39m
     [32mâœ“[39m should adjust for fat loss goal[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle GLP-1 + Nausea (Smaller meals)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Blood Sugar focus (Even carb spread)[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle Dairy Issues[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should adjust for progress (Stall in fat loss)[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m src/features/nutrition/NutritionPage.test.tsx [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 236[2mms[22m[39m
     [32mâœ“[39m renders preference inputs[32m 70[2mms[22m[39m
     [32mâœ“[39m updates preferences state when inputs change[32m 135[2mms[22m[39m
[31m     [31mÃ—[31m shows generate button[39m[32m 31[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
âœ… Nutrition tools initialized

[90mstdout[2m | backend/tests/nutritionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mgenerates a meal plan with correct system prompt payload
[22m[39mâœ… Generated meal plan for 2025-01-01 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mğŸ—“ï¸ Generating 7 days in parallel...
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-01
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-02
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-03
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-04
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-05
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-06
ğŸ“Œ Reusing 1 locked meal(s) for 2025-01-07
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...
âœ… Generated meal plan for 2025-01-01 in 1ms
âœ… Generated meal plan for 2025-01-02 in 2ms
âœ… Generated meal plan for 2025-01-03 in 2ms
âœ… Generated meal plan for 2025-01-04 in 1ms
âœ… Generated meal plan for 2025-01-05 in 1ms
âœ… Generated meal plan for 2025-01-06 in 1ms
âœ… Generated meal plan for 2025-01-07 in 1ms

[90mstdout[2m | backend/tests/nutritionService.test.ts[2m > [22m[2mRealNutritionAiService[2m > [22m[2mreuses locked meals during week generation
[22m[39mâœ… All 7 days generated in parallel

 [32mâœ“[39m backend/tests/nutritionService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mGET /health[2m > [22m[2mreturns 200 and status ok
[22m[39mğŸ“¬ GET /health

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ“¬ POST /api/nutrition/plan/week
ğŸ¯ generateWeeklyPlan called - request received
ğŸ“¦ Request body: {
  "weekStartDate": "2025-01-01",
  "targets": {
    "caloriesPerDay": 2000,
    "proteinGrams": 150,
    "carbsGrams": 200,
    "fatGrams": 65
  },
  "userContext": {
    "city": "Test City",
    "locale": "en-US"
  }
}

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/progress-smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/simulation-real-week.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | backend/tests/nutritionist-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstderr[2m | backend/tests/progress-smoke.test.ts[2m > [22m[2mProgress Tracking Smoke Tests[2m > [22m[2mshould generate insights when enough data is logged
[22m[39mlogNutritionDay error: TypeError: meal.foodItems is not iterable
    at NutritionLogRepository.logNutritionDay (C:/Users/rober/Documents/Coach/backend/db/repositories/NutritionLogRepository.ts:57:41)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at logNutritionDay (C:/Users/rober/Documents/Coach/backend/routes.ts:404:17)

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ—“ï¸ Generating 7 days in parallel...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Using OpenAI with model: gpt-4o-mini
ğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

 [31mâ¯[39m backend/tests/progress-smoke.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 417[2mms[22m[39m
[31m     [31mÃ—[31m should generate insights when enough data is logged[39m[32m 58[2mms[22m[39m
     [32mâœ“[39m should handle empty week gracefully[32m 190[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Database connected at: [35m2025-11-23T21:35:34.883Z[39m

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
=== STARTING REAL USER SIMULATION ===

1. Generating Program...
   Generated 3 sessions.
   Focus: Muscle building and hypertrophy

2. Verifying Warmups...
   Day monday (full): 8 min warmup
   Day wednesday (full): 8 min warmup
   Day friday (full): 8 min warmup

3. Logging Data...

..[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

.[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Workouts logged.

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

.[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mğŸ¤– Calling gpt-4o-mini for daily meal plan (no tools)...

......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Nutrition logged.

.......[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m Weight logged.

4. Verifying Dashboard & Insights...

[90mstdout[2m | backend/tests/simulation-real-week.test.ts[2m > [22m[2mReal User Week Simulation[2m > [22m[2mshould run a full week simulation
[22m[39m
--- DASHBOARD SUMMARY ---
Workouts: 3 / 3
Warmup Adherence: 3 / 3
Nutrition Days: 7 / 7
Weight Trend: increasing

--- COACH NOTES (INSIGHTS) ---
> Nice: you're consistently doing your warmup. That's exactly what long-term knees and shoulders like.
> ğŸ“Š Excellent tracking! You logged 7 days.
> ğŸ¯ You're hitting your calorie goals consistently.
> ğŸ“ˆ Weight trending up slightly.
> ğŸ”¥ You're crushing it this week! Great consistency across workouts and nutrition.
----------------------------


 [32mâœ“[39m backend/tests/simulation-real-week.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1022[2mms[22m[39m
 [31mâ¯[39m backend/tests/nutritionist-api.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1214[2mms[22m[39m
[31m     [31mÃ—[31m should save and retrieve a profile[39m[33m 350[2mms[22m[39m
     [33m[2mâœ“[22m[39m should run a check-in [33m 344[2mms[22m[39m
[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-04 in 16837ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-06 in 17694ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-03 in 17987ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-07 in 19962ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-02 in 20863ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-05 in 21747ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Generated meal plan for 2025-01-01 in 23283ms

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… All 7 days generated in parallel

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/week[2m > [22m[2mgenerates a weekly meal plan
[22m[39mâœ… Weekly plan generated, sending response

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ“¬ POST /api/nutrition/plan/day/regenerate-meal

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mğŸ”„ Regenerating breakfast for 2025-01-01
   Remaining budget: 2000 kcal, 150g P, 200g C, 65g F

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 1
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, whole, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'oats, rolled, dry'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'banana, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 2
   ğŸ”§ Calling search_generic_food: { query: [32m'chicken breast, grilled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'Greek yogurt, plain, nonfat'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 3
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 4
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, cooked'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 5
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, boiled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 6
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, scrambled'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 7
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, fried'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 8
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 9
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   Tool iteration 10
   ğŸ”§ Calling search_generic_food: { query: [32m'egg, large, raw'[39m }

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39m   ğŸ”§ Calling search_generic_food: { query: [32m'almond butter'[39m }

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mâŒ Meal regeneration error: Error: LLM returned empty response
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1331:15)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46)

[90mstderr[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22m[2mregenerates a specific meal
[22m[39mregenerateMeal error: NutritionApiError: Failed to regenerate meal. Please try again.
    at RealNutritionAiService.regenerateMeal (C:/Users/rober/Documents/Coach/backend/RealNutritionAiService.ts:1428:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at regenerateMeal (C:/Users/rober/Documents/Coach/backend/routes.ts:250:46) {
  code: [32m'AI_PLAN_FAILED'[39m,
  retryable: [33mtrue[39m,
  details: { originalError: [32m'Error: LLM returned empty response'[39m }
}

[90mstdout[2m | backend/tests/api.test.ts[2m > [22m[2mBackend API Integration[2m > [22m[2mPOST /api/program/week/generate[2m > [22m[2mgenerates a workout week from onboarding state
[22m[39mğŸ“¬ POST /api/program/week/generate

 [31mâ¯[39m backend/tests/api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 69179[2mms[22m[39m
       [32mâœ“[39m returns 200 and status ok[32m 19[2mms[22m[39m
       [33m[2mâœ“[22m[39m generates a weekly meal plan [33m 23822[2mms[22m[39m
[31m       [31mÃ—[31m regenerates a specific meal[39m[33m 45332[2mms[22m[39m
       [32mâœ“[39m generates a workout week from onboarding state[32m 6[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 3 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m backend/tests/nutritionist-api.test.ts[2m > [22mAI Nutritionist API[2m > [22mshould save and retrieve a profile
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'metformin')[39m
[36m [2mâ¯[22m backend/tests/nutritionist-api.test.ts:[2m59:38[22m[39m
    [90m 57| [39m
    [90m 58| [39m        [34mexpect[39m(getRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 59| [39m        [34mexpect[39m(getRes[33m.[39mbody[33m.[39mdata[33m.[39mmeds[33m.[39mmetformin)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 60| [39m    })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/3]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/progress-smoke.test.ts[2m > [22mProgress Tracking Smoke Tests[2m > [22mshould generate insights when enough data is logged
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/progress-smoke.test.ts:[2m71:32[22m[39m
    [90m 69| [39m                    meals[33m:[39m [{ type[33m:[39m [32m'breakfast'[39m[33m,[39m items[33m:[39m [] }][33m,[39m
    [90m 70| [39m                })[33m;[39m
    [90m 71| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 72| [39m        }
    [90m 73| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/3]â¯[22m[39m

[41m[1m FAIL [22m[49m backend/tests/api.test.ts[2m > [22mBackend API Integration[2m > [22mPOST /api/nutrition/plan/day/regenerate-meal[2m > [22mregenerates a specific meal
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2mâ¯[22m backend/tests/api.test.ts:[2m68:37[22m[39m
    [90m 66| [39m                [33m.[39m[34msend[39m(payload)[33m;[39m
    [90m 67| [39m
    [90m 68| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 69| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m'meals'[39m)[33m;[39m
    [90m 70| [39m            expect(response.body.data.meals[0].items.length).toBeGreatâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/3]â¯[22m[39m


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (10)[39m
[2m      Tests [22m [1m[31m26 failed[39m[22m[2m | [22m[1m[32m18 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 16:35:32
[2m   Duration [22m 76.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
